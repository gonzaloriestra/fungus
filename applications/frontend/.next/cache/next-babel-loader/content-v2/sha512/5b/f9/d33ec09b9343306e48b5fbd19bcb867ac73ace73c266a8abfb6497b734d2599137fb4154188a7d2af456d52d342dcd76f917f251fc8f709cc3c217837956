{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useState } from 'react';\nimport { Map as MapLeaflet, WMSTileLayer, TileLayer, Polygon, FeatureGroup } from 'react-leaflet';\nimport { EditControl } from 'react-leaflet-draw';\nimport styles from './map.module.css';\n\nfunction mapPositionFromZone(zone) {\n  if (zone && zone.midpoint) {\n    return {\n      lat: zone.midpoint.latitude,\n      lng: zone.midpoint.longitude\n    };\n  }\n}\n\nconst Map = ({\n  mode = 'view',\n  location,\n  initialZoom = 15,\n  onLocationCreated = () => {}\n}) => {\n  const initialPosition = mapPositionFromZone(location === null || location === void 0 ? void 0 : location.zone) || {\n    lat: 42.829022,\n    lng: -4.849545\n  };\n  const {\n    0: position\n  } = useState(initialPosition);\n  const {\n    0: zoom\n  } = useState(initialZoom);\n  const {\n    0: hasLocationDefined,\n    1: setHasLocationDefined\n  } = useState(mode === 'view');\n\n  const renderEditionMode = mode => {\n    if (mode !== 'edit') {\n      return null;\n    }\n\n    const handleOnCreate = event => {\n      var _event$layer, _event$layer$editing;\n\n      if ((_event$layer = event.layer) !== null && _event$layer !== void 0 && (_event$layer$editing = _event$layer.editing) !== null && _event$layer$editing !== void 0 && _event$layer$editing.latlngs[0][0]) {\n        var _event$layer2, _event$layer2$editing;\n\n        const coordinates = (_event$layer2 = event.layer) === null || _event$layer2 === void 0 ? void 0 : (_event$layer2$editing = _event$layer2.editing) === null || _event$layer2$editing === void 0 ? void 0 : _event$layer2$editing.latlngs[0][0];\n        setHasLocationDefined(true);\n        onLocationCreated(coordinates.map(coordinate => ({\n          latitude: coordinate.lat,\n          longitude: coordinate.lng\n        })));\n      }\n    };\n\n    const handleOnDelete = event => {\n      var _event$layers;\n\n      if (((_event$layers = event.layers) === null || _event$layers === void 0 ? void 0 : _event$layers.getLayers().length) > 0) {\n        setHasLocationDefined(false);\n      }\n    };\n\n    return /*#__PURE__*/_jsx(FeatureGroup, {\n      children: /*#__PURE__*/_jsx(EditControl, {\n        position: \"topright\",\n        draw: {\n          rectangle: false,\n          circle: false,\n          marker: false,\n          circlemarker: false,\n          polyline: false,\n          polygon: hasLocationDefined ? false : {\n            allowIntersection: false,\n            drawError: {\n              color: '#e1e100',\n              message: 'Oops! you cannot draw in that way.'\n            },\n            shapeOptions: {\n              color: '#b5cc18'\n            }\n          }\n        },\n        onCreated: handleOnCreate,\n        onDeleted: handleOnDelete\n      })\n    });\n  };\n\n  const renderLocation = location => {\n    if (!location) {\n      return null;\n    }\n\n    const zone = location === null || location === void 0 ? void 0 : location.zone;\n    return /*#__PURE__*/_jsx(Polygon, {\n      positions: zone.coordinates.map(coordinate => [coordinate.latitude, coordinate.longitude])\n    });\n  };\n\n  return /*#__PURE__*/_jsxs(MapLeaflet, {\n    className: styles.container,\n    center: position,\n    zoom: zoom,\n    children: [/*#__PURE__*/_jsx(TileLayer, {\n      url: \"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\"\n    }), /*#__PURE__*/_jsx(WMSTileLayer, {\n      url: \"https://www.ign.es/wms-inspire/ign-base\",\n      format: \"image/png\",\n      layers: \"IGNBaseOrto\",\n      transparent: true\n    }), renderEditionMode(mode), renderLocation(location)]\n  });\n};\n\nexport default Map;","map":null,"metadata":{},"sourceType":"module"}